# 实时平面目标跟踪

## 完成一个如以下视频所示的平面跟踪演示程序：

平面模板可以提前制作好并存贮在文件里，避免每次运行都
要交互框选

### 要求:

速度达到实时 (25 帧/秒 +)
跟踪稳定，不要有明显的错误和抖动
尝试结合连续特征跟踪（KLT 方法，cv::calcOpticalFlowPyrLK）改
善速度和稳定性
详细记录实验过程中针对遇到问题的解决方案和结果

## 基本思想
+ 基于光流法
  + 基本假设条件  
   + 亮度恒定不变
   + 时间连续或运动幅度微小
   + 保持空间一致性
  + 原理
    + 对一个连续的视频帧序列进行处理
    + 针对每一个视频序列，利用一定的目标检测方法，检测可能出现的前景目标
    + 如果某一帧出现了前景目标，找到其具有代表性的关键特征点
    + 对之后的任意两个相邻视频帧而言，寻找上一帧中出现的关键特征点在当前帧中的最佳位置，从而得到前景目标在当前帧中的位置坐标
  + 主要优点
    + 稀疏光流并不对图像的每个像素点进行逐点计算。它通常需要指定一组点进行跟踪，这组点最好具有某种明显的特性，例如 Harris角点等，那么跟踪就会相对稳定和可靠。稀疏跟踪的计算开销比稠密跟踪小得多，实时计算速度效果较好

## 实验流程
+ 主要步骤
  + 根据模板利用 SIFT 选择初始帧特征点
  + 开始跟踪:
    + 通过函数 cvCalcOpticalFlowPyrLK 跟踪特征点
    + 删除损失特征点
    + 对对应角点进行筛选, 抛弃表现不好的点
    + 替换前后帧, 即将后帧作为下一帧的前帧
  + 当遇到角点过少时:  
    重新与模板进行匹配得到该帧角点
+ 跟踪可视化
  + 将每次的特征点转换为 KeyPoint 格式, 然后通过 SIFT 计算特征向量和描述子并匹配
  + 利用 drawMatches() 函数对每帧与模板对应的特征点进行匹配连线
## 总结分析
1. 最开始没有使用光流法, 单独用 SIFT/SURF 对每一帧和模板进行匹配, 实时性不好, 并且每一帧特征选择之间关联不大, 猜想是前后帧之间没有有效联系。
2. 第二次修改时, 只使用光流法 KLT 跟踪时, 初始化特征点是利用自带的 goodFeaturesToTrack, 跟踪过程中只进行特征点的剔除。发现效果也不是很好, 特征点会慢慢变少; 或者当出现偏离后, 之后一段时间内都保持偏离状态。猜想是由于之后每一帧都没有与模板进行适当联系。
3. 第三次, 在光流法基础上, 为每次跟踪时发现跟踪点较少时都重新与模板进行匹配以增加初始化特征点集。效果出现明显提高, 但是出现许多被匹配到的外点连线, 猜想是由于比例因子过大。
4. 之后又对特征点选择的比例因子进行调整，找到比较良好的参数范围。
5. 此时对于平移, 旋转, 倾斜等情况都能匹配到, 但是仍然有因为幅度较大以及平面光照不均匀、时有反光等因素导致的匹配错误。
